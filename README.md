# leader-follwer-lab
Followers bidding for control

Lab 3 - Bidding to become master 
•	6% of your final grade
•	Individual lab, not a team lab, no collaboration is allowed!
•	Check out our Academic Integrity policy here.  If two or more students' lab assignments are very similar, all will receive a minimum penalty of a zero on the given lab assignment. 
Lab Description
In this lab, students are asked to program three motes.  At any time, one mote will serve as the current "master" while the other two serve as "slaves".  The two slaves will bid to become the master in the next cycle by generating a random number each and asking the master to compare the two numbers. The slave mote with the larger number will win the competition and become the new master.  The loser and the old master will become new slaves in the next cycle.  The detailed steps of each cycle are like below:

1.	The master shows 7 on its LED lights (all three lights are on) to indicate he is the master in this cycle.  Then the master should set up a one-shot timer to allow the LED display to last for an adjustable interval (around 5 seconds).
2.	After the timer fires, the master broadcasts a message to start the bidding process.  In the meantime, the master clears its LEDs.
3.	After a slave mote receives the message from the master, it generates a random number between 1 and 6 (inclusive) and then shows the number on its LED lights for an adjustable interval (again, by using one-shot timer).  The reason that we want the number to be between 1 and 6 is that (1) it is hard to judge whether the mote is working or not with 0; and (2) 7 is reserved for a mote to indicate that he is the master in the beginning of a cycle.
4.	After the timer fires, the slave mote sends out its bidding (the random number) to the master.
Steps 3 to 4 apply to both the two slave motes.
5.	The master receives one bidding from one slave and stores it.
6.	The master receives the second bidding.  The master needs to make sure that this bidding is from the second slave instead of the same slave who sent the first bidding.
7.	The master compares the two biddings.  The slave mote with larger number wins the competition.  If there is a tie, the first bidder (the first slave from which the master receives the bidding) wins.
8.	The master displays the winner's bidding on its three LED lights (again, by using one shot timer) so that we can see the master is having the same display with the winner at this point.
9.	After the timer fires, the master will send a message to the winner to announce that he wins the mastership.  The master will then change its own status from master to slave and clear its LEDs.
10.	The loser remains in the slave mode and clear its LEDs.
11.	The winner receives the announcement from the master and then sets its own status to master.
12.	The next cycle starts by jumping to step 1.
•	Initially, the mote with network ID as 1 should automatically become the master in the first cycle. This mote is connected to the PC, and transmits the bidding results (numbers generated by two slaves) to the PC. These results are displayed via Oscilloscope on PC.
•	The hardest part of this lab is how to synchronize between different motes and how to correctly change the states of each mote based on the message it receives now. Doing this in the first cycle is not very hard, but it is hard to let the program run correctly for several continuous cycles without causing the states of each mote to mess up. Therefore, your program is required to be able to run at least 10 continuous cycles without any problems.   
o	TA: please make sure the students' program can work for at least 10 cycles at check-off.  If the program doesn't work for 10 cycles, please write down how many cycles the program actually runs correctly.
•	What do you need to do?
o	Read and understand the application in the directory /opt/tinyos-2.x/apps/RadioSenseToLeds. This application is a demo program to send and receive the sensor readings between two motes.
o	Read and understand the applications in the directory /opt/tinyos-2.x/apps/BaseStation and /opt/tinyos-2.x/apps/Oscilloscope. These applications are demo programs for transmitting and visualizing data on PC.
o	Based on the sequence of each cycle (Step 1 to Step 13), use different state variables to react differently to different messages received by a mote and handle differently for different time-out events.
o	Debug your program to make sure it is working correctly.
•	HINT: Please think about the problem carefully before you start to write code and decide beforehand how many state variables you may need.  Note that unnecessary state variables may increase program size which is important to embedded systems.  Be sure to draw a state machine for each of the critical functions such as Timer.fired() and Receive.Receive().
•	After you are done, you should ask a TA to check you off.  The TAs' office hours are on the main page of this course website. Then you should turn in a printed copy of your program.
•	Grading
o	(20%) You can run your program correctly from step 1 to step 9 in the first cycle.
o	(10%) You can run your program correctly for the first cycle.
o	(10%) You can run your program correctly for the second cycle as well.
o	(20%) You can run your program correctly for the first five cycles.
o	(10%) You can run your program correctly for all the 10 cycles.
o	(10%) You can visualize the bidding results via Oscilloscope on PC.
o	(20%) The program
	(10%) Whether your code is easy to read? Whether you have enough comments to explain your code? (TA should be able to understand your code)
	(10%) Whether you are using your state variables correctly?  Are there any unnecessary state variables?  Did you check the validity of your input, e.g., did you check whether the message is from the second slave at Step 7?
•	Additional check-off (right after the code downloaded to the motes) may be required after grading the submitted program.
•	The system should be working as follows:
o	Let us name the three motes in the video as A, B and C based on their locations
o	      A
B
      C

C is initially the master by having the ID as 1
A bids 1 and B bids 2
C acks B wins
B becomes the master
A bids 1 and C bids 4
B acks C wins
C becomes the master
A bids 2 and B bids 1
C acks A wins
A becomes the master
B bids 4 and C bids 1
A acks B wins
B becomes the master
A bids 4 and C bids 1
B acks A wins
A becomes the master
B bids 1 and C bids 4
A acks that C wins
C becomes the master
A bids 6 and B bids 3
C acks A wins
A becomes the master
B bids 1 and C bids 6
A acks C wins
C becomes the master
A bids 6 and B bids 6  (tie!)
C acks A wins because it receives bidding from A first
A becomes the master
B bids 5 and C bids 6
A acks C wins
C becomes the master
A bids 2 and B bids 6
C acks B wins
B becomes the master
A bids 2 and C bids 6
B acks C wins
C becomes the master
A bids 6 and B bids 5
end
0

